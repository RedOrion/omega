<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" 
                    "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <script src="http://localhost/omega-test/omega/vendor/jquery-1.7.1.min.js"></script>
  <script src="http://localhost/omega-test/omega/vendor/jquery-ui-1.7.1.min.js"></script>
  <script src="http://localhost/omega-test/omega/vendor/jquery.cookie.js"></script>
  <link rel="stylesheet" href="http://code.jquery.com/qunit/git/qunit.css" type="text/css" media="screen" />
  <script type="text/javascript" src="http://code.jquery.com/qunit/git/qunit.js"></script>

  <script type="text/javascript" src="http://localhost/omega-test/omega/vendor/rjr/json.js"></script>
  <script type="text/javascript" src="http://localhost/omega-test/omega/vendor/rjr/jrw.js"></script>
  <script type="text/javascript" src="http://localhost/omega-test/omega/omega/client.js"></script>
  <script type="text/javascript" src="http://localhost/omega-test/omega/omega/commands.js"></script>
  <script type="text/javascript" src="http://localhost/omega-test/omega/omega/user.js"></script>
  <script type="text/javascript" src="http://localhost/omega-test/omega/omega/entity.js"></script>
  <script type="text/javascript" src="http://localhost/omega-test/omega/omega/canvas.js"></script>
  <script type="text/javascript" src="http://localhost/omega-test/omega/omega/dialog.js"></script>
  <script type="text/javascript" src="http://localhost/omega-test/omega/omega/navigation.js"></script>

  <script>
  $(document).ready(function(){

function before_all(details){
  // login user
  var user = new JRObject("Users::User", {id : 'mmorsi', password: 'isromm'});
  login_user(user);
}

QUnit.moduleStart(before_all);
//QUnit.testStart(before_each);
//QUnit.testDone(after_each);
//QUnit.moduleDone(after_all);

module("omega_ui");

///////////////////////////// commands.js:

asyncTest("select ship destination", 2, function() {
  $tracker.load('Manufactured::Ship', 'mmorsi-corvette-ship2', function(ship){
    select_ship_destination(ship);
    var display = $('#omega_dialog').css('display');
    equal("block", display);
    ok($('#omega_dialog #dest_x') != null);
    start();
  });
});

asyncTest("select ship target", 2, function() {
  $tracker.load('Manufactured::Ship', 'mmorsi-corvette-ship3', function(ship){
    select_ship_target(ship);
    var display = $('#omega_dialog').css('display');
    equal("block", display);
    ok($('#omega_dialog .ship_launch_attack[value=opponent-mining-ship1]') != null);
    start();
  });
});

asyncTest("select ship dock", 2, function() {
  $tracker.load('Manufactured::Ship', 'mmorsi-corvette-ship3', function(ship){
    select_ship_dock(ship);
    var display = $('#omega_dialog').css('display');
    equal("block", display);
    ok($('#omega_dialog .ship_dock[value=mmorsi-manufacturing-station1]') != null);
    start();
  });
});

//asyncTest("select ship transfer", 2, function() {
//});
//
//asyncTest("select ship mining", 2, function() {
//});

///////////////////////////// canvas.js:

test("show/hide/append to entity container", function() {
  show_entity_container(["foo", "bar"]);
  var display = $('#omega_entity_container').css('display');
  var value   = $('#entity_container_contents').html();
  equal("block", display);
  equal("foobar", value);
  append_to_entity_container(["aaa", "bbb"]);
  value   = $('#entity_container_contents').html();
  equal("foobaraaabbb", value);
  hide_entity_container();
  display = $('#omega_entity_container').css('display');
  equal("none", display);
});

//asyncTest("scene changed callback", 2, function() {
//  // TODO
//});

///////////////////////////// dialog.js:

test("show/hide/append to dialog", function() {
  $omega_dialog.show('title', '#omega_dialog_content', '+some');
  var display = $('#omega_dialog').css('display');
  var value   = $('#omega_dialog').html();
  equal("block", display);
  equal("content+some", value);
  $omega_dialog.append("evenmore");
  value   = $('#omega_dialog').html();
  equal("content+someevenmore", value);
  $omega_dialog.hide();
  display = $('#omega_dialog').css('display');
  // FIXME this isn't working right
  //equal("none", display);
});

///////////////////////////// nav.js:

test("show login/logout controls", function() {
  show_login_controls();
  equal("inline", $('#register_link').css('display'));
  equal("inline", $('#login_link').css('display'));
  equal("none", $('#logout_link').css('display'));
  equal("none", $('#account_link').css('display'));
  show_logout_controls();
  equal("none", $('#register_link').css('display'));
  equal("none", $('#login_link').css('display'));
  equal("inline", $('#logout_link').css('display'));
  equal("inline", $('#account_link').css('display'));
});

//test("show login/register dialog", function() {
//  show_login_dialog();
//  show_register_dialog();
//});

// TODO test submit dialogs?

  });
  </script>
  
</head>
<body>
 <h1 id="qunit-header">QUnit example</h1>
 <h2 id="qunit-banner"></h2>
 <div id="qunit-testrunner-toolbar"></div>
 <h2 id="qunit-userAgent"></h2>
 <ol id="qunit-tests"></ol>
 <div id="qunit-fixture">test markup, will be hidden</div>

 <a id="register_link" /><a id="account_link" /><a id="login_link" /><a id="logout_link" />
 <div id="omega_canvas"></div>
 <div id="omega_entity_container"><div id="entity_container_contents"></div></div>
 <div id="omega_dialog"></div>
 <div id="omega_dialog_content">content</div>
</body>
</html>
