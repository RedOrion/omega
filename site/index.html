<html>
  <head>
    <link rel="stylesheet" type="text/css" href="motel.css" />
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script type="text/javascript" src="rjr/json.js"></script>
    <script type="text/javascript" src="rjr/jrw.js"></script>
    <script type="text/javascript" src="motel.js"></script>
    <script type="text/javascript">
      var current_system = null;
      var client = new CosmosClient();
      client.onopen = function(){
        //loc = new Location();
        //loc.x=20; loc.y=-30; loc.z=15;
        //client.ws_node.invoke_request('create_location', loc);
                                      
        //client.track_location(2, 5);
        //client.track_location(3, 5);
        //client.get_entity('solarsystem', 'system1');
        //client.get_entity('galaxy', 'galaxy1');

        if(current_system == null){
          client.get_entity('galaxy', 'galaxy1');
        }else
          client.get_entity('solarsystem', current_system);
      }
      client.message_received = function(msg){
        //console.log(msg);
      }
      client.onsuccess = function(result){
        //console.log(result);
        if(result.json_class == "Cosmos::Galaxy"){
          data  = result.name;
          data += "<ul>";
          for(var s=0;s<result.solar_systems.length;++s){
            var sname = result.solar_systems[s].name;
            data += "<li>";
            data += "<span id='" + sname + "'class='entity_title solar_system_title'>" + sname + "</span>";
            data += "<ul>";
              for(var p=0;p<result.solar_systems[s].planets.length;++p){
                var pname = result.solar_systems[s].planets[p].name;
                data += "<li>" + pname + "</li>";
              }
            data += "</ul>";
            data += "</li>";
          }
          data += "</ul>";
          $("#motel_locations_container").html(data);
          $('.solar_system_title').live('click', function(event){
            current_system = event.currentTarget.id;
            client.disconnect();
            client.clear_locations();
            client.connect();
          });
          $('#motel_canvas_container canvas').css('background', 'url("http://localhost/wotel/galaxy.png") no-repeat');

        }else if(result.json_class == "Cosmos::SolarSystem"){
          //client.get_location(result.star.location.id);
          result.star.location.entity = result.star;
          client.add_location(result.star.location);

          for(var p=0; p<result.planets.length; ++p){
            planet = result.planets[p];
            planet.location.entity = planet;
            client.add_location(planet.location);

            //console.log(planet);
            client.track_location(planet.location.id, 5);
          }
          $('#motel_canvas_container canvas').css('background', 'url("http://localhost/wotel/system.png") no-repeat');

        }

      }
      client.onfailed = function(error, msg){
        //console.log(error);
        //console.log(msg);
      }
      client.connect();
    </script>
  </head>
  <body>
    <div id="motel_locations_container">Locations:</div>
    <div id="motel_canvas_container">
      <canvas id="motel_canvas" width="1500" height="700"></canvas>
    </div>
  </body>
</html>
